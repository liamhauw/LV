file(
  GLOB_RECURSE 
  GLSL_SHADERS
  CONFIGURE_DEPENDS 
  "${CMAKE_CURRENT_SOURCE_DIR}/glsl/*.vert"
  "${CMAKE_CURRENT_SOURCE_DIR}/glsl/*.frag"
)

if (NOT EXISTS ${CMAKE_CURRENT_SOURCE_DIR}/spirv)
  file(MAKE_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/spirv)
endif()

set(SPIRV_SHADERS "")

foreach(GLSL_SHADER ${GLSL_SHADERS})
    get_filename_component(SHADER_NAME ${GLSL_SHADER} NAME)
    set(SPIRV_SHADER "${CMAKE_CURRENT_SOURCE_DIR}/spirv/${SHADER_NAME}.spv")
    add_custom_command(
      OUTPUT ${SPIRV_SHADER}
      COMMAND ${Vulkan_GLSLANG_VALIDATOR_EXECUTABLE} -I${CMAKE_CURRENT_SOURCE_DIR}/include -V100 -o ${SPIRV_SHADER} ${GLSL_SHADER}
      DEPENDS ${GLSL_SHADER}
      WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    )
    list(APPEND SPIRV_SHADERS ${SPIRV_SHADER})
endforeach()

add_custom_target(glsl2spirv DEPENDS ${SPIRV_SHADERS} SOURCES ${GLSL_SHADERS})